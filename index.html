<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Pack Opening ULTRA Bling</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { background: #222; color: #fff; text-align: center; font-family: sans-serif; }
    .popup-bg {
      position: fixed; left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.92); z-index: 9; display: flex; align-items: center; justify-content: center;
    }
    .pack-opening-card {
      width: 320px; height: 480px; position: relative; overflow: hidden; border-radius: 16px; box-shadow: 0 6px 32px #000;
      background: #111;
      margin: auto;
      user-select: none;
    }
    .card-bw, .card-color {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background-size: contain; background-repeat: no-repeat; background-position: center;
      pointer-events: none;
    }
    .card-bw { filter: grayscale(1) brightness(0.7) contrast(1.1); }
    .card-color { /* mask animé JS */ }
    #particle-canvas {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5;
    }
    button.open-btn {
      margin-top: 30px; font-size: 1.4em; padding: 14px 28px; border-radius: 8px; border: none; background: gold; color: #333; font-weight: bold; cursor: pointer;
      box-shadow: 0 2px 10px #000a;
    }
  </style>
</head>
<body>
  <button class="open-btn" onclick="openPack()">Ouvrir une carte !</button>

  <div id="popup" style="display:none;">
    <div class="popup-bg" onclick="closePopup(event)">
      <div class="pack-opening-card" id="packCard">
        <div class="card-bw" id="bw" style="background-image: url('img/1.png')"></div>
        <div class="card-color" id="color" style="background-image: url('img/1.png')"></div>
        <canvas id="particle-canvas" width="320" height="480"></canvas>
      </div>
    </div>
  </div>
<script>
function openPack() {
  document.getElementById('popup').style.display = '';
  startPackAnimation();
}
function closePopup(e) {
  if (e.target.classList.contains('popup-bg')) document.getElementById('popup').style.display = 'none';
}

function startPackAnimation() {
  const color = document.getElementById('color');
  const bw = document.getElementById('bw');
  const canvas = document.getElementById('particle-canvas');
  const ctx = canvas.getContext('2d');
  color.style.clipPath = "inset(0 100% 0 0)";
  canvas.width = 320; canvas.height = 480;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  let start = null;
  const duration = 1500; // ms
  const particles = [];

  function animateParticles(frontX) {
    // Beaucoup de particules brillantes par frame
    for (let i = 0; i < 64; i++) {
      const y = Math.random() * canvas.height;
      const angle = (Math.random()-0.5)*Math.PI/2;
      const vx = Math.cos(angle) * (Math.random()*1.2 + 0.5);
      const vy = Math.sin(angle) * (Math.random()*1.2 + 0.5);
      const colorList = [
        "#fff", "#ffe066", "#9ffcff", "#f9f06b", "#fffbe6", "#fcf5ff", "#fff2", "#fffb"
      ];
      const glowColor = colorList[Math.floor(Math.random()*colorList.length)];
      particles.push({
        x: frontX + Math.random()*16-8,
        y, vx, vy,
        r: 3 + Math.random()*2,
        color: glowColor,
        life: 0,
        maxLife: 15 + Math.random()*10,
        glow: true
      });
    }
    // Énorme brillance "frontière" : quelques rayons
    for (let i=0; i<6; i++) {
      const y = Math.random() * canvas.height;
      particles.push({
        x: frontX, y,
        vx: (Math.random()-0.5)*0.7, vy: (Math.random()-0.5)*0.7,
        r: 14 + Math.random()*12,
        color: "#fff",
        life: 0,
        maxLife: 10 + Math.random()*10,
        glow: true
      });
    }
  }

  function drawParticles() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for (let i=particles.length-1; i>=0; i--) {
      const p = particles[i];
      ctx.save();
      if (p.glow) {
        ctx.shadowColor = p.color;
        ctx.shadowBlur = 12 + Math.random()*12;
      } else {
        ctx.shadowBlur = 0;
      }
      ctx.globalAlpha = Math.max(0, 1 - p.life/p.maxLife);
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, 2*Math.PI);
      ctx.fillStyle = p.color;
      ctx.fill();
      ctx.globalAlpha = 1;
      ctx.restore();

      p.x += p.vx;
      p.y += p.vy;
      p.life += 1;
      if (p.life > p.maxLife) particles.splice(i, 1);
    }
  }

  function step(ts) {
    if (!start) start = ts;
    const progress = Math.min(1, (ts-start)/duration);
    const right = Math.round(320 - 320*progress);
    color.style.clipPath = `inset(0 ${right}px 0 0)`;

    // Génère particules super denses à la frontière
    animateParticles(320 - progress*320);
    drawParticles();

    // Brillance sur tout le bord (style "halo")
    if (progress < 1) {
      requestAnimationFrame(step);
    } else {
      color.style.clipPath = "none";
      setTimeout(() => { ctx.clearRect(0,0,canvas.width,canvas.height); }, 400);
    }
  }
  requestAnimationFrame(step);
}
</script>
</body>
</html>
